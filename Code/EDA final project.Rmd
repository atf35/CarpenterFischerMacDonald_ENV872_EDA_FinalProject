---
output: pdf
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Seasonal Salt Content, in the Neuse"
subtitle: "Web address for GitHub repository"
author: "Atalie Fischer, Kathlyn MacDonald, Jack Carpenter"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
# Set your working directory
# setwd("/Users/kmac9/OneDrive/Documents/Duke/Year 1/Spring 2022/ENV Data/CarpenterFischerMacDonald_ENV872_EDA_FinalProject/")
# setwd("/Users/ataliefischer/Desktop/EDA/CarpenterFischerMacDonald_ENV872_EDA_FinalProject/")
getwd()

# Load packages
library(tidyverse)
library(lubridate)
library(trend)
library(forecast)
library(dataRetrieval)
library(sf)
library(maps)
library(knitr)


<<<<<<< HEAD
# Set your ggplot theme
mytheme <- theme_classic(base_size = 10) +
=======
# Set ggplot theme
mytheme <- theme_classic(base_size = 14) +
>>>>>>> 73b56b6a48e32d67e663afb77aebe92c8f00d274
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")

## Load datasets

#load water quality data for the Neuse River at Kinston, NC
NeuseWQ <- readWQPqw(siteNumbers = "USGS-02089500", # Neuse River at Kinston, NC
                     parameterCd = c("00915", # calcium, filtered mg/L
                                     "00925", # magnesium, filtered mg/L
                                     "00930", # sodium,filtered mg/L
                                     "90095"),  # Specific conductance, uS/cm
                     startDate = "1976-01-01",
                     endDate = "")
write.csv(NeuseWQ, row.names = TRUE, file = "../Data/Raw/NeuseWQ_raw.csv")

#load discharge data for Neuse River at Kinston, NC
NeuseFlow <- readNWISdv(siteNumbers = "02089500", # Neuse River at Kinston, NC
                     parameterCd = "00060", # discharge (cfs)
                     startDate = "1976-01-01",
                     endDate = "")
write.csv(NeuseFlow, row.names = TRUE, file = "../Data/Raw/NeuseFlow_raw.csv")
```

```{r wrangling}
## Clean up datasets

# water quality dataset
NeuseWQ_processed <- NeuseWQ %>%
  select(MonitoringLocationIdentifier, ActivityStartDate, HydrologicCondition, 
         CharacteristicName, ResultMeasureValue) %>%
  mutate(Variable = case_when(CharacteristicName == "Calcium" ~ "Ca_mg.L",
                              CharacteristicName == "Magnesium" ~ "Mg_mg.L",
                              CharacteristicName == "Sodium" ~ "Na_mg.L",
                              CharacteristicName == "Specific conductance" ~ "SpC_uS.cm")) %>%
  select(-CharacteristicName) %>%
  pivot_wider(names_from = "Variable", values_from = "ResultMeasureValue") %>% 
  mutate(Year = year(ActivityStartDate),
         Month = month(ActivityStartDate)) %>%
  group_by(Year, Month) %>%
  summarise(AvgCa_mg.L = mean(Ca_mg.L),
            AvgMg_mg.L = mean(Mg_mg.L),
            AvgNa_mg.L = mean(Na_mg.L),
            AvgSpC_uS.cm = mean(SpC_uS.cm)) 
write.csv(NeuseWQ_processed, row.names = TRUE, file = "../Data/Processed/NeuseWQ_processed.csv")

# flow dataset
NeuseFlow_processed <- NeuseFlow %>%
  select(ActivityStartDate = Date, discharge_cfs = X_00060_00003) %>% 
  mutate(Year = year(ActivityStartDate),
         Month = month(ActivityStartDate)) %>%
  group_by(Year, Month) %>%
  summarise(AvgDischarge_cfs = mean(discharge_cfs))
write.csv(NeuseFlow_processed, row.names = TRUE, file = "../Data/Processed/NeuseFlow_processed.csv")


## create sequence of dates with even spacing 
Months <- data.frame(Date_monthrounded = seq.Date(from = as.Date("1976-01-01"), to = as.Date("2022-12-01"), by = "month"))


## Combine datasets
NeuseWQFlow_processed <- NeuseWQ_processed %>%
  full_join(., NeuseFlow_processed)

NeuseWQFlow_monthly <- left_join(Months, NeuseWQFlow_processed)


write.csv(NeuseWQFlow_processed, row.names = TRUE, file = "../Data/Processed/NeuseWQFlow_processed.csv")
```


# Rationale and Research Questions (Kathlyn)
> The maintenance of healthy and functioning water systems is critical not just to human life, but also to the survival of countless other species and their interconnected ecosystems. We are only beginning to understand the impact of human action on water bodies. Conductivity, or the ability of water to pass an electrical current via dissolved salts and other minerals, is a strong indicator of water quality. Changes in conductivity over time suggest a potential pollutant entering the system. 

> For this study, we chose to analyze how specific conductance can vary depending on the season. In particular, we wanted to address the impact of winterizing the roadways with salt on water quality. Our main research question was: is salting the roads a main driver in changes to water conductivity, or are other  minerals a significant factor? Here, we chose to analyze the Neuse River in Kinston, North Carolina over a 46 year period (1976-2022) (???, check on this bc of the NAs). We chose this river due to familiarity with the data and its proximity to an urban center (Kinston pop = 20,398). ADD MORE!

> We used the following research questions to guide our work: 
> 1. How does specific conductance vary seasonally? 
> 2. Is calcium, magnesium, or sodium the driver of specific conductance?
> 3. What is the likely specific conductance in the future (forcasting trends)?


\newpage

# Dataset Information (Jack)
> Neuse River water quality and discharge data at Kinston, North Carolina. The gage information comes from the United States Geologic Survey (USGS) National Water Information Systems (NWIS) database. Since seasonal salinity trends and their potential sources are the focus of this study, the water quality data being examined includes specific conductivity and concentrations of calcium, magnesium, and sodium in the water column. Specific conductivity will be used as a proxy for salinization, and the relative amounts of each salt ion will be examined in the hopes of identifying a potential source of any seasonal salinity increases, in particular the contribution of road salts to salinization.

Dataset           | Info
------------------|------------------------
NeuseWQ           |
NeuseFlow         |


\newpage

# Exploratory Analysis (Atalie)

As an initial step in the exploratory analysis, we summarized both the water quality and flow datasets to find the number of missing observations. 

We looked at specific conductivity and discharge over time to visualize any gaps in our datasets. An initial look at specific conductance over time shows a gap in our dataset in the mid-2000's (Figure []). This gap will need to be filled before conducting any time series analyses on this dataset. 
```{r Map}
?
```

```{r Dataset Summaries, echo=FALSE}
summary(NeuseWQ_processed) #contains NA in dataset
summary(NeuseFlow_processed)

summary(NeuseWQFlow_processed)


NeuseWQFlow_summary <- NeuseWQFlow_processed %>% 
    group_by(Variable) %>% 
    summarise(Mean = mean(Value),
              Min = min(Value),
              Max = max(Value),
              SD = sd(Value))

```

```{r display summary tables, echo=FALSE}
kable(NeuseWQFlow_summary, caption = "Summary")
```


```{r Specific conductivity over time, echo=FALSE}
ggplot(NeuseWQ_processed) +
  geom_point(aes(x = ActivityStartDate, y = SpC_uS.cm)) +
  labs(title = "Specific Conductance over time in the Neuse River",
       x = "Sample Date", y = expression("Specific Conductance ("*mu*"S/cm)")) #notice gap in dataset
```
```{r Discharge over time}
ggplot(NeuseFlow_processed) +
  geom_line(aes(x = ActivityStartDate, y = discharge_cfs)) +
  labs(title = "Flow over time in the Neuse River",
       x = "Sample Date", y = expression("Discharge (cfs)"))
```




\newpage

# Analysis

*time series!*


## Question 1: < How does specific conductance vary seasonally? >

## Question 2: <Is calcium, magnesium, or sodium the driver of specific conductance?>

##Question 3: <What is the likely specific conductance in the future (forcasting trends)?>



\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
