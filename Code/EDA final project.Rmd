---
output: pdf
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Seasonal Salt Content, in the Neuse"
subtitle: "Web address for GitHub repository"
author: "Atalie Fischer, Kathlyn MacDonald, Jack Carpenter"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
# Set your working director
# setwd("/Users/kmac9/OneDrive/Documents/Duke/Year 1/Spring 2022/ENV Data/CarpenterFischerMacDonald_ENV872_EDA_FinalProject/")
# setwd("/Users/ataliefischer/Desktop/EDA/CarpenterFischerMacDonald_ENV872_EDA_FinalProject/")
getwd()

# Load packages
library(tidyverse)
library(lubridate)
library(trend)
library(forecast)
library(dataRetrieval)


# Set ggplot theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")

## Load datasets

#load water quality data for the Neuse River at Kinston, NC
NeuseWQ <- readWQPqw(siteNumbers = "USGS-02089500", # Neuse River at Kinston, NC
                     parameterCd = c("00915", # calcium, filtered mg/L
                                     "00925", # magnesium, filtered mg/L
                                     "00930", # sodium,filtered mg/L
                                     "90095"),  # Specific conductance, uS/cm
                     startDate = "1976-01-01",
                     endDate = "")
write.csv(NeuseWQ, row.names = TRUE, file = "../Data/Raw/NeuseWQ_raw.csv")

#load discharge data for Neuse River at Kinston, NC
NeuseFlow <- readNWISdv(siteNumbers = "02089500", # Neuse River at Kinston, NC
                     parameterCd = "00060", # discharge (cfs)
                     startDate = "1976-01-01",
                     endDate = "")
write.csv(NeuseFlow, row.names = TRUE, file = "../Data/Raw/NeuseFlow_raw.csv")

## Clean up datasets

# water quality dataset
NeuseWQ_processed <- NeuseWQ %>%
  select(MonitoringLocationIdentifier, ActivityStartDate, HydrologicCondition, 
         CharacteristicName, ResultMeasureValue) %>%
  mutate(Variable = case_when(CharacteristicName == "Calcium" ~ "Calcium_mg.L",
                              CharacteristicName == "Magnesium" ~ "Magnesium_mg.L",
                              CharacteristicName == "Sodium" ~ "Sodium_mg.L",
                              CharacteristicName == "Specific conductance" ~ "SpC_uS.cm")) %>%
  select(-CharacteristicName) %>%
  pivot_wider(names_from = "Variable", values_from = "ResultMeasureValue")
write.csv(NeuseWQ_processed, row.names = TRUE, file = "../Data/Processed/NeuseWQ_processed.csv")

# flow dataset
NeuseFlow_processed <- NeuseFlow %>%
  select(ActivityStartDate = Date, discharge_cfs = X_00060_00003) %>%
  filter(ActivityStartDate >= min(NeuseWQ_processed$ActivityStartDate) & 
           ActivityStartDate <= max(NeuseWQ_processed$ActivityStartDate)) #include dates that pertain to water quality variables
write.csv(NeuseFlow_processed, row.names = TRUE, file = "../Data/Processed/NeuseFlow_processed.csv")

## Combine datasets
NeuseWQFlow_processed <- NeuseWQ_processed %>%
  full_join(., NeuseFlow_processed) %>%
  mutate(Year = year(ActivityStartDate), 
         Month = month(ActivityStartDate), 
         DOY = yday(ActivityStartDate)) %>%
  pivot_longer(cols = c("SpC_uS.cm", 
                        "Sodium_mg.L", 
                        "Magnesium_mg.L", 
                        "Calcium_mg.L", 
                        "discharge_cfs"),
               names_to = "Variable", values_to = "Value") %>%
  drop_na(Value)
write.csv(NeuseWQFlow_processed, row.names = TRUE, file = "../Data/Processed/NeuseWQFlow_processed.csv")
```


# Rationale and Research Questions
> How does specific conductance vary seasonally? 
> Is calcium, magnesium, or sodium the driver of specific conductance?
> What is the likely specific conductance in the future (forcasting trends)?


\newpage

# Dataset Information (Jack)
> Neuse River water quality and discharge data at Kinston, North Carolina. The gage information comes from the United States Geologic Survey (USGS) National Water Information Systems (NWIS) database. Since seasonal salinity trends and their potential sources are the focus of this study, the water quality data being examined includes specific conductivity and concentrations of calcium, magnesium, and sodium in the water column. Specific conductivity will be used as a proxy for salinization, and the relative amounts of each salt ion will be examined in the hopes of identifying a potential source of any seasonal salinity increases, in particular the contribution of road salts to salinization.


\newpage

# Exploratory Analysis (Atalie)
```{r Dataset Summaries}
summary(NeuseWQ_processed)
summary(NeuseFlow_processed) #contains NA in dataset
```

```{r Variables over time}
ggplot(NeuseWQ_processed) +
  geom_point(aes(x = ActivityStartDate, y = SpC_uS.cm)) +
  labs(title = "Specific Conductance over time in the Neuse River",
       x = "Sample Date", y = expression("Specific Conductance ("*mu*"S/cm)")) #notice gap in dataset

ggplot(NeuseFlow_processed) +
  geom_line(aes(x = ActivityStartDate, y = discharge_cfs)) +
  labs(title = "Flow over time in the Neuse River",
       x = "Sample Date", y = expression("Discharge (cfs)"))
```




\newpage

# Analysis



## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
